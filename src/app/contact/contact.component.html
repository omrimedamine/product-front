<div class="contact-page">
  <p-card header="Contactez-nous" styleClass="contact-card">
    @if(submitted() && contactForm.valid) {
      <div class="success-container">
        <p-messages [(value)]="messages" [closable]="false"></p-messages>
        <div class="success-actions">
          <button pButton label="Nouveau message" icon="pi pi-plus" (click)="resetForm()"></button>
        </div>
      </div>
    } @else {
      <form [formGroup]="contactForm" (ngSubmit)="onSubmit()">
        <div class="field">
          <label for="email">Email *</label>
          <input
            id="email"
            type="email"
            pInputText
            formControlName="email"
            placeholder="Votre adresse email"
            class="w-full"
            [ngClass]="{'ng-invalid ng-dirty': isFieldInvalid('email')}"
          />
          @if(isFieldInvalid('email')) {
            <small class="p-error">
              @if(contactForm.get('email')?.hasError('required')) {
                Email requis
              } @else if(contactForm.get('email')?.hasError('email')) {
                Format d'email invalide
              }
            </small>
          }
        </div>

        <div class="field">
          <label for="message">Message * <span class="char-count">{{ characterCount() }}/300</span></label>
          <textarea
            id="message"
            pInputTextarea
            formControlName="message"
            placeholder="Votre message (300 caractères max)"
            class="w-full"
            rows="5"
            [ngClass]="{'ng-invalid ng-dirty': isFieldInvalid('message')}"
            (input)="updateCharCount()"
          ></textarea>
          @if(isFieldInvalid('message')) {
            <small class="p-error">
              @if(contactForm.get('message')?.hasError('required')) {
                Message requis
              } @else if(contactForm.get('message')?.hasError('maxlength')) {
                Le message ne doit pas dépasser 300 caractères
              }
            </small>
          }
        </div>

        <div class="form-actions">
          <button
            pButton
            type="submit"
            label="Envoyer"
            icon="pi pi-send"
            [disabled]="contactForm.invalid"
          ></button>
        </div>
      </form>
    }
  </p-card>
</div>
