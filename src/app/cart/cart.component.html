<div class="cart-button-container">
  <button pButton class="p-button-text" (click)="toggleCartDisplay()">
    <i class="pi pi-shopping-cart" style="font-size: 2rem"></i>
    @if(cartService.itemCount() > 0) {
      <span class="cart-badge">{{ cartService.itemCount() }}</span>
    }
  </button>
</div>

<!-- Sidebar du panier -->
<p-sidebar  [(visible)]="sidebarVisible"
            position="right"
            [style]="{width:'35em'}"
            (onHide)="onSidebarHide()">
  <h2>Mon Panier</h2>

  @if (cartService.getCartItems()().length === 0) {
    <div class="empty-cart">
      <i class="pi pi-shopping-cart" style="font-size: 3rem; color: #ccc;"></i>
      <p>Votre panier est vide</p>
    </div>
  } @else {
    <p-table [value]="cartService.getCartItems()()" styleClass="cart-table">
      <ng-template pTemplate="header">
        <tr>
          <th scope="col">Produit</th>
          <th scope="col">Prix unitaire</th>
          <th scope="col">Quantit√©</th>
          <th scope="col">Total</th>
          <th scope="col"></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>
            <div class="product-info">
              <span>{{ item.name || item.code }}</span>
            </div>
          </td>
          <td>{{ item.price | currency:'EUR' }}</td>
          <td>
            <p-inputNumber
              buttonLayout="horizontal"
              [min]="1"
              [max]="10"
              [step]="1"
              [(ngModel)]="item.cartQuantity"
              (onInput)="updateQuantity(item, item.cartQuantity)">
            </p-inputNumber>
          </td>
          <td>{{ getItemTotal(item) | currency:'EUR' }}</td>
          <td>
            <button pButton icon="pi pi-trash"
                    class="p-button-danger p-button-sm"
                    (click)="removeItem(item)"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <div class="cart-total">
      <span>Total: {{ cartService.totalAmount() | currency:'EUR' }}</span>
    </div>

    <div class="cart-actions">
      <button pButton label="Vider le panier" icon="pi pi-trash"
              class="p-button-outlined p-button-danger"
              (click)="clearCart()"></button>

    </div>
  }
</p-sidebar>
